<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>CRASTINA: RESET SEQUENCE</title> <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#050507">
  <style>
    /* === Crastina Visual System v3.2 (Refined) === */
    :root {
      --bg-deep: #050507;
      --bg-surface: rgba(255, 255, 255, 0.03);
      --border-light: rgba(255, 255, 255, 0.08);
      --text-primary: #e0e0e0;
      --text-muted: #666;
      --brand-reset-bg: #e6e2d6; /* Reset æ¨¡å¼çš„åº•è‰² */
      --brand-reset-text: #3e3b34;
      
      /* ä¿ç•™åŠŸèƒ½æ€§è®Šæ•¸ä»¥ç¶­æŒå…¼å®¹æ€§ */
      --fg: var(--text-primary);
      --muted: var(--text-muted);
      --chip-bg: rgba(255, 255, 255, 0.03);
      --chip-bd: rgba(255, 255, 255, 0.10);
      --seg-ind-1: rgba(255, 255, 255, 0.10);
      --seg-ind-2: rgba(255, 255, 255, 0.06);
      --seg-border: rgba(255, 255, 255, 0.18);
    }

    /* å…¨å±€è¨­å®š */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    
    body {
      background-color: var(--bg-deep);
      background-image: linear-gradient(to bottom, #0a0a0f, #000); /* æ·±æ²ˆçš„æ·±æ·µæ„Ÿ */
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      display: grid;
      place-items: center;
      padding: 18px;
      overflow-x: hidden;
      transition: background 1.2s ease, color 0.8s ease; /* å»¶é•·è½‰å ´æ™‚é–“ï¼Œå¢åŠ å„€å¼æ„Ÿ */
    }

    /* === RESET æ¨¡å¼ (åŸ Rest) === */
    body[data-mode="rest"] {
      background-color: var(--brand-reset-bg);
      background-image: linear-gradient(to bottom, #efece4, #e3dfd2); /* ç´™å¼µè³ªæ„Ÿ */
      color: var(--brand-reset-text);
    }
    
    /* åœ¨ Reset æ¨¡å¼ä¸‹çš„å…ƒä»¶è¦†å¯« */
    body[data-mode="rest"] :is(.display, .note-card, .segmented) {
      background: rgba(255, 255, 255, 0.4);
      border-color: rgba(0, 0, 0, 0.08);
      box-shadow: 0 10px 40px rgba(189, 183, 169, 0.4);
    }
    body[data-mode="rest"] .seg-btn { color: #666; }
    body[data-mode="rest"] .seg-btn.right { color: #000; }
    body[data-mode="rest"] .time { text-shadow: none; color: #2a2a2a; }
    body[data-mode="rest"] .big-start { border-color: #3e3b34; color: #3e3b34; }
    body[data-mode="rest"] .big-start:hover { background: #3e3b34; color: #f0f0f0; }

    /* === æ ¸å¿ƒå®¹å™¨ === */
    .wrap { width: min(1100px, 100%); padding: 8px 6px; }
    
    .brand-title {
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.3em;
      font-size: 14px;
      margin-bottom: 20px;
      color: var(--text-muted);
      text-transform: uppercase;
      opacity: 0.6;
    }

    /* === é ­éƒ¨æ§åˆ¶å€ === */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }

    /* æ¨¡å¼åˆ‡æ›å™¨ */
    .segmented {
      position: relative;
      display: inline-flex;
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: 999px;
      padding: 4px;
      backdrop-filter: blur(10px);
    }
    .seg-inner { display: flex; position: relative; z-index: 2; }
    .seg-btn {
      appearance: none; border: 0; background: transparent;
      color: #888; padding: 8px 20px; font-size: 13px; font-weight: 600;
      cursor: pointer; transition: color 0.3s;
      display: flex; align-items: center; gap: 6px;
    }
    .segmented[data-active="focus"] .left { color: #fff; }
    
    /* æ»‘å‹•æŒ‡ç¤ºå™¨ */
    .seg-indicator {
      position: absolute; top: 4px; left: 4px; bottom: 4px; width: calc(50% - 4px);
      background: rgba(255,255,255,0.1); border-radius: 999px;
      transition: transform 0.3s cubic-bezier(0.2, 0, 0.2, 1); z-index: 1;
    }
    .segmented[data-active="rest"] .seg-indicator { transform: translateX(100%); }

    /* === ä¸»é¡¯ç¤ºå€ (Glassmorphism) === */
    .grid { display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 24px; align-items: start; }
    @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }

    .display {
      background: var(--bg-surface);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid var(--border-light);
      border-radius: 32px;
      padding: 48px 24px;
      text-align: center;
      box-shadow: 0 30px 60px rgba(0,0,0,0.5);
      position: relative;
      overflow: hidden;
    }

    /* å‘¼å¸å‹•æ•ˆï¼šåªåœ¨é‹è¡Œä¸­çš„ Reset æ¨¡å¼å•Ÿå‹• */
    @keyframes breathe {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.015); filter: brightness(1.03); }
    }
    body.is-running[data-mode="rest"] .display {
      animation: breathe 6s ease-in-out infinite;
      border-color: rgba(200, 180, 150, 0.3);
    }

    .time {
      font-family: 'Courier New', monospace; /* å·¥æ¥­é¢¨æ ¼ */
      font-size: clamp(64px, 15vw, 130px);
      font-weight: 300;
      letter-spacing: -4px;
      line-height: 1;
      font-variant-numeric: tabular-nums;
      margin-bottom: 8px;
    }

    .status { font-size: 13px; color: var(--text-muted); letter-spacing: 1px; min-height: 20px; }

    /* è¼¸å…¥å€ï¼šæ¥µç°¡åŒ– */
    .inputs { margin-top: 24px; display: flex; gap: 12px; justify-content: center; opacity: 0.5; transition: opacity 0.3s; }
    .inputs:hover, .inputs:focus-within { opacity: 1; }
    .field input {
      background: transparent; border: 0; border-bottom: 1px solid var(--text-muted);
      color: inherit; font-size: 18px; width: 60px; text-align: center; padding: 4px;
      font-family: inherit;
    }

    /* å•Ÿå‹•æŒ‰éˆ• */
    .controls { margin-top: 32px; display: flex; justify-content: center; }
    .big-start {
      width: 140px; height: 140px; border-radius: 50%;
      background: transparent;
      border: 1px solid var(--text-primary);
      color: var(--text-primary);
      font-size: 14px; font-weight: 700; letter-spacing: 1px;
      cursor: pointer; transition: all 0.4s ease;
      display: grid; place-items: center;
    }
    .big-start:hover { transform: scale(1.05); }
    body.is-running .big-start { border-style: double; border-width: 4px; animation: pulse 2s infinite; }
    
    /* çµæŸæç¤ºæ–‡æ¡ˆ */
    .done-wrap { margin-top: 24px; min-height: 40px; }
    .done-line {
      font-size: 16px; line-height: 1.6; color: var(--text-primary);
      opacity: 0; transform: translateY(10px); transition: all 1s ease;
    }
    .done-line.show { opacity: 1; transform: translateY(0); }
    .product-link {
        display: block; margin-top: 8px; font-size: 12px; 
        color: var(--text-muted); text-decoration: underline; cursor: pointer;
    }

    /* === å³å´åŠŸèƒ½å€ === */
    .shortcuts { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 24px; }
    .sbtn {
      background: rgba(255,255,255,0.05); border: 1px solid transparent;
      color: inherit; padding: 16px; border-radius: 12px;
      font-size: 18px; font-weight: 600; cursor: pointer;
      transition: all 0.2s;
    }
    .sbtn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }

    .note-card {
      background: var(--bg-surface); border: 1px solid var(--border-light);
      border-radius: 20px; padding: 20px;
    }
    .note-text {
      width: 100%; background: transparent; border: 0;
      color: inherit; font-size: 14px; line-height: 1.6;
      resize: none; min-height: 120px; outline: none;
      font-family: inherit;
    }
    .note-meta { font-size: 11px; color: var(--text-muted); margin-top: 8px; display: block; }
    
    /* å…¶ä»–å°å·¥å…· */
    .utility-row { display: flex; gap: 16px; justify-content: flex-end; font-size: 12px; color: var(--text-muted); align-items: center; }
    .utility-row input { margin-right: 4px; }
    
    footer { margin-top: 40px; opacity: 0.3; font-size: 11px; text-align: center; }
  </style>
</head>
<body data-mode="rest"> <div class="wrap">
    <div class="brand-title">CRASTINA</div>

    <header>
      <div class="segmented" id="segmented" data-active="rest">
        <div class="seg-indicator"></div>
        <div class="seg-inner">
          <button class="seg-btn left" id="focusModeBtn">OUTPUT</button>
          <button class="seg-btn right" id="restModeBtn">RESET</button>
        </div>
      </div>

      <div class="utility-row">
         <label><input type="checkbox" id="vibrateToggle"> è§¸è¦ºåé¥‹</label>
         <button id="soundTestBtn" style="background:none;border:none;color:inherit;cursor:pointer;">ğŸ”Š è©¦éŸ³</button>
      </div>
    </header>

    <div class="grid">
      <section class="display">
        <div class="time" id="timeText">05:00</div>
        <div class="status" id="statusText">READY TO RESET</div>

        <div class="inputs">
          <div class="field"><input id="mins" type="number" value="5" />m</div>
          <div class="field"><input id="secs" type="number" value="0" />s</div>
        </div>

        <div class="controls">
          <button class="big-start" id="startPauseBtn">INITIATE</button>
        </div>

        <div class="done-wrap">
          <div id="doneText" class="done-line"></div>
        </div>
      </section>

      <aside>
        <div class="shortcuts" id="shortcuts">
          </div>

        <div class="note-card">
          <div style="font-size:12px; font-weight:700; margin-bottom:10px; opacity:0.7;">INSIGHT CAPTURE</div>
          <textarea id="noteText" class="note-text" placeholder="åœ¨é›œè¨Šéœæ­¢å¾Œï¼Œä½ è½è¦‹äº†ä»€éº¼ï¼Ÿ"></textarea>
          <div style="display:flex; justify-content:space-between; align-items:center;">
             <span class="note-meta" id="noteHint">çµæŸå¾Œç´€éŒ„</span>
             <button id="saveNoteBtn" style="border:1px solid currentColor; background:transparent; color:inherit; padding:4px 12px; border-radius:99px; font-size:11px; cursor:pointer;">SAVE</button>
          </div>
        </div>
        
        <div id="noteList" style="margin-top:20px; font-size:12px; opacity:0.8; display:grid; gap:8px;"></div>
      </aside>
    </div>

    <footer>Designed by Suspension Sequence Co.</footer>
  </div>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const body = document.body;
  const timeText = $('#timeText'), statusText = $('#statusText');
  const mins = $('#mins'), secs = $('#secs'), startPauseBtn = $('#startPauseBtn');
  const focusModeBtn = $('#focusModeBtn'), restModeBtn = $('#restModeBtn'), seg = $('#segmented');
  const doneText = $('#doneText');
  
  const MODE = { FOCUS: 'focus', REST: 'rest' };
  
  // === Audio Engine: The Ethereal Arpeggio (å¤¢å¹»ç¶éŸ³) ===
  let audioCtx = null;
  
  function getAudioCtx() { 
    if(!audioCtx) {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      audioCtx = new AudioContext();
    }
    return audioCtx; 
  }

  function wakeUpAudioEngine() {
    const ctx = getAudioCtx();
    if (ctx.state === 'suspended') ctx.resume();
    try {
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        g.gain.value = 0; 
        o.start(0); o.stop(0.01);
    } catch(e) {}
  }

  // æ ¸å¿ƒä¿®æ”¹ï¼šä¸‰å’Œçµƒç¶éŸ³ (Db Major + Octave)
  function playArpeggio() {
    const ctx = getAudioCtx();
    if(ctx.state === 'suspended') ctx.resume();
    
    const now = ctx.currentTime;
    
    // Db Major: Db4(277.18), F4(349.23), Ab4(415.30) + Db5(554.37)
    // åŠ ä¸Šå…«åº¦éŸ³(Db5)æœƒè®“è½æ„Ÿæœ‰ä¸€ç¨®ã€Œå®Œæˆã€èˆ‡ã€Œæ˜‡è¯ã€çš„æ„Ÿè¦º
    const notes = [277.18, 349.23, 415.30, 554.37]; 
    
    notes.forEach((freq, index) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        osc.type = 'sine'; 
        osc.frequency.value = freq;
        
        osc.connect(gain);
        gain.connect(ctx.destination);

        // æ™‚é–“å·®ï¼šæ¯å€‹éŸ³é–“éš” 0.18 ç§’ï¼Œå‰µé€ æµå‹•æ„Ÿ
        const startTime = now + (index * 0.18);
        const duration = 2.5; // æ¯å€‹éŸ³çš„é¤˜éŸ»é•·åº¦

        // Envelope: æŸ”å’Œæ·¡å…¥ -> ç·©æ…¢æ·¡å‡º
        gain.gain.setValueAtTime(0, startTime);
        gain.gain.linearRampToValueAtTime(0.12, startTime + 0.05); // Attack
        gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration); // Release

        osc.start(startTime);
        osc.stop(startTime + duration);
    });
  }

  // è©¦éŸ³
  $('#soundTestBtn').addEventListener('click', () => {
      wakeUpAudioEngine();
      playArpeggio();
  });

  // === æ¨¡å¼åˆ‡æ› ===
  function setMode(mode){ 
    body.setAttribute('data-mode', mode); 
    seg.dataset.active = mode; 
    if(mode === MODE.REST) statusText.textContent = 'READY TO RESET';
    else statusText.textContent = 'READY TO OUTPUT';
  }
  
  focusModeBtn.addEventListener('click', () => setMode(MODE.FOCUS));
  restModeBtn.addEventListener('click', () => setMode(MODE.REST));
  setMode(MODE.REST);

  // === è¨ˆæ™‚å™¨é‚è¼¯ ===
  let total = 300, timer = null, running = false, endAt = null;

  function format(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
  }

  function updateDisplay() {
      timeText.textContent = format(total);
      document.title = running ? `${format(total)} - CRASTINA` : 'CRASTINA';
  }

  const shortcutVals = [5, 10, 25, 45];
  const scWrap = $('#shortcuts');
  shortcutVals.forEach(m => {
      const b = document.createElement('button');
      b.className = 'sbtn';
      b.textContent = m;
      b.onclick = () => { 
          mins.value = m; secs.value = 0; 
          total = m * 60; 
          updateDisplay(); 
          if(!running) start(); 
      };
      scWrap.appendChild(b);
  });

  [mins, secs].forEach(input => input.addEventListener('change', () => {
      total = parseInt(mins.value||0)*60 + parseInt(secs.value||0);
      updateDisplay();
  }));

  function start() {
      if(total <= 0) return;
      wakeUpAudioEngine(); 

      running = true;
      endAt = Date.now() + total * 1000;
      body.classList.add('is-running');
      startPauseBtn.textContent = 'PAUSE';
      statusText.textContent = (body.getAttribute('data-mode') === MODE.REST) ? 'BREATHE...' : 'FLOWING...';
      doneText.classList.remove('show');
      
      timer = setInterval(() => {
          const left = Math.ceil((endAt - Date.now()) / 1000);
          if (left <= 0) {
              finish();
          } else {
              total = left;
              updateDisplay();
          }
      }, 1000);
  }

  function pause() {
      running = false;
      clearInterval(timer);
      body.classList.remove('is-running');
      startPauseBtn.textContent = 'RESUME';
      statusText.textContent = 'SUSPENDED';
  }

  function finish() {
      running = false;
      clearInterval(timer);
      total = 0;
      updateDisplay();
      body.classList.remove('is-running');
      startPauseBtn.textContent = 'INITIATE';
      statusText.textContent = 'SEQUENCE COMPLETE';

      if($('#vibrateToggle').checked && navigator.vibrate) navigator.vibrate([50, 50, 50]);
      
      playArpeggio(); // æ’­æ”¾ç¶éŸ³

      const mode = body.getAttribute('data-mode');
      let msg = "";
      if (mode === MODE.REST) {
          msg = "ç¯€å¥å·²é‡ç½®ã€‚<br>ç¾åœ¨æ˜¯ä½¿ç”¨ <b>Reset Oil</b> é–ä½å¹³éœç‹€æ…‹çš„æœ€ä½³æ™‚åˆ»ã€‚";
      } else {
          msg = "è¼¸å‡ºæš«å‘Šä¸€æ®µè½ã€‚<br>å»ºè­°åˆ‡æ›è‡³ <b>RESET</b> æ¨¡å¼é€²è¡Œ 5 åˆ†é˜çš„ç¥ç¶“ç³»çµ±å†·å»ã€‚";
      }
      doneText.innerHTML = msg;
      doneText.classList.add('show');
  }

  startPauseBtn.addEventListener('click', () => {
      if(running) pause();
      else start();
  });
  
  $('#saveNoteBtn').addEventListener('click', () => {
     const txt = $('#noteText').value;
     if(!txt) return;
     const div = document.createElement('div');
     div.textContent = `â€¢ ${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})} ${txt}`;
     $('#noteList').prepend(div);
     $('#noteText').value = '';
     $('#noteHint').textContent = 'Saved.';
     setTimeout(() => $('#noteHint').textContent = 'çµæŸå¾Œç´€éŒ„', 2000);
  });

  updateDisplay();
})();
</script>
